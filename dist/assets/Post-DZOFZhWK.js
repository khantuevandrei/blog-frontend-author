import{b as E,j as e,B as h,T as d,M as j,u as S,y as B,r as l,a as L,z as D,P as A,G as p,A as M}from"./index-D2KaLZNc.js";import{B as W}from"./BackButton-BbDVQbHQ.js";import z from"./ErrorPage-CDTRS__O.js";function G({comment:c,isLast:m}){const r=E();return e.jsxs(h,{sx:{mb:2,pb:2,borderBottom:m?"none":"1px solid gray"},children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsxs(d,{variant:"subtitle1",fontWeight:600,children:["@",c.author.username]}),e.jsx(j,{value:c.created_at})]}),e.jsx(d,{variant:"body1",sx:{whiteSpace:"pre-line",color:r.palette.text.primary},children:c.body})]})}function O(){const c=S(),m=E(),{postId:r}=B(),{token:f}=l.useContext(L),[x,n]=l.useState(null),[a,C]=l.useState(),[u,o]=l.useState({overlay:!0,edit:!1,publish:!1,delete:!1,next:!1,nextAll:!1}),[g,v]=l.useState([]),[_,k]=l.useState(0),[w,b]=l.useState(!0);l.useEffect(()=>{async function s(){o(t=>({...t,overlay:!0}));try{const t=await fetch(`https://blog-backend-production-16f8.up.railway.app/api/posts/${r}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`bearer ${f}`}}),i=await t.json();if(!t.ok){n(i.message);return}C(i),v(i.comments),i.total_comments<5&&b(!1),i.total_comments>5&&(b(!0),k(5))}catch{n("Network error")}finally{o(t=>({...t,overlay:!1}))}}s()},[r,f]);async function $(){n(null),o(s=>({...s,publish:!0}));try{const s=await fetch(`https://blog-backend-production-16f8.up.railway.app/api/posts/${r}/publish`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`bearer ${f}`}}),t=await s.json();if(!s.ok){n(t.message);return}C(t)}catch{n("Network error")}finally{o(s=>({...s,publish:!1}))}}async function T(){n(null),o(s=>({...s,delete:!0}));try{const s=await fetch(`https://blog-backend-production-16f8.up.railway.app/api/posts/${r}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`bearer ${f}`}}),t=await s.json();if(!s.ok){n(t.message);return}c("/")}catch{n("Network Error")}finally{o(s=>({...s,delete:!1}))}}async function P(s){s>5?o(t=>({...t,nextAll:!0})):o(t=>({...t,next:!0}));try{if(!w)return;const t=await fetch(`https://blog-backend-production-16f8.up.railway.app/api/posts/${r}/comments?limit=${s}&offset=${_}`),i=await t.json();if(!t.ok){n(i.message||"Failed to get comments");return}v(N=>{const y=[...N,...i.comments];return a.total_comments>y.length&&(b(!0),k(y.length)),a.total_comments===y.length&&b(!1),y})}catch{n("Network error")}finally{o(t=>({...t,next:!1})),o(t=>({...t,nextAll:!1}))}}return u.overlay?e.jsx(D,{}):x?e.jsx(z,{message:x}):e.jsxs(h,{sx:{flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[e.jsxs(A,{elevation:2,sx:{p:4,borderRadius:3,width:"100%",maxWidth:600,mt:10,position:"relative",[m.breakpoints.up("sm")]:{mt:6}},children:[e.jsx(W,{nav:"/"}),e.jsx(d,{variant:"h5",fontWeight:600,mb:2,children:a.title}),e.jsxs(d,{variant:"subtitle1",sx:{color:m.palette.text.secondary,mb:1},children:["by ",e.jsxs("strong",{children:["@",a.author.username]})]}),e.jsx(j,{label:"Created",value:a.created_at}),a.updated_at!==a.created_at&&e.jsx(j,{label:"Updated",value:a.updated_at}),e.jsx(j,{label:a.published?"Published":"Not published",value:a.published_at}),e.jsx(d,{variant:"body1",sx:{whiteSpace:"pre-line",mt:4,mb:2},children:a.body}),e.jsxs(h,{sx:{display:"flex",justifyContent:"center",gap:1},children:[e.jsx(p,{name:"Edit",onClick:()=>c(`/${r}/edit`)}),e.jsx(p,{name:a.published?"Unpublish":"Publish",disabled:u.publish,onClick:$}),e.jsx(p,{name:"Delete",disabled:u.delete,onClick:T})]}),e.jsx(M,{error:x,children:x})]}),g.length>0&&e.jsxs(A,{elevation:2,sx:{p:4,borderRadius:3,my:6,width:"100%",maxWidth:600},children:[e.jsx(d,{variant:"h5",fontWeight:600,mb:2,children:"Comments:"}),g.map((s,t)=>e.jsx(G,{comment:s,isLast:t===g.length-1},s.id)),e.jsxs(h,{sx:{display:"flex",gap:2,mt:2},children:[w&&e.jsx(p,{name:"Next 5",disabled:u.next,onClick:()=>P(5)}),w&&e.jsx(p,{name:"Load all",disabled:u.nextAll,onClick:()=>P(a.total_comments)})]})]})]})}export{O as default};
