import{b as S,j as e,C as B,c as F,r as i,a as N,B as T,A as P}from"./index-D2KaLZNc.js";import{F as g,a as O,b as v}from"./FormButton-D_UYJ-45.js";import{P as y}from"./PasswordField-DTg_QMIC.js";import{B as $}from"./BackButton-BbDVQbHQ.js";import{v as q,a as z,U as D,P as E}from"./PasswordChecklist-em9FOc2c.js";function C({success:w,children:u}){const n=S();return e.jsx(B,{in:!!w,timeout:300,children:e.jsx(F,{severity:"success",sx:{mt:1,bgcolor:n.palette.success.dark,color:n.palette.success.contrastText,fontSize:14},children:u})})}function R(){const w=S(),{user:u,token:n,login:U}=i.useContext(N),[l,o]=i.useState({username:null,password:null}),[m,p]=i.useState({username:null,password:null}),[x,t]=i.useState({username:!1,password:!1}),[a,f]=i.useState({username:"",password:"",confirmPassword:""}),j=q(a.username),b=z(a.password,a.confirmPassword);function h(d){f({...a,[d.target.name]:d.target.value.trim()})}async function k(d){if(d.preventDefault(),t(s=>({...s,username:!0})),o(s=>({...s,username:null})),p(s=>({...s,username:null})),Object.values(j).some(s=>!s)){t(!1),o(s=>({...s,username:"Please fix username validation errors"}));return}try{const s=await fetch(`https://blog-backend-production-16f8.up.railway.app/api/users/${u.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`bearer ${n}`},body:JSON.stringify({username:a.username})}),c=await s.json();if(!s.ok){o(r=>({...r,username:c.message}));return}f(r=>({...r,username:""})),p(r=>({...r,username:"Username updated"})),U(n,c)}catch{o(s=>({...s,username:"Network error"}))}finally{t(s=>({...s,username:!1}))}}async function A(d){if(d.preventDefault(),t(s=>({...s,password:!0})),o(s=>({...s,password:null})),p(s=>({...s,password:null})),Object.values(b).some(s=>!s)){t(!1),o(s=>({...s,password:"Please fix password validation errors"}));return}if(a.password!==a.confirmPassword){o(s=>({...s,password:"Passwords do not match"}));return}try{const s=await fetch(`https://blog-backend-production-16f8.up.railway.app/api/users/${u.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`bearer ${n}`},body:JSON.stringify({password:a.password})}),c=await s.json();if(!s.ok){o(r=>({...r,password:c.message}));return}f(r=>({...r,password:"",confirmPassword:""})),p(r=>({...r,password:"Password updated"}))}catch{o(s=>({...s,password:"Network error"}))}finally{t(s=>({...s,password:!1}))}}return e.jsxs(T,{sx:{display:"flex",flexDirection:"column",flexGrow:1,width:"100%",gap:4,pt:6,[w.breakpoints.up("sm")]:{pt:0}},children:[e.jsxs(g,{width:400,name:"Update username",onSubmit:k,mb:0,children:[e.jsx($,{nav:"/"}),e.jsx(O,{label:"New username",name:"username",value:a.username,onChange:h,required:!0}),e.jsx(D,{username:a.username,validations:j}),e.jsx(P,{error:l.username,children:l.username}),e.jsx(C,{success:m.username,children:m.username}),e.jsx(v,{name:"Update",disabled:x.username})]}),e.jsxs(g,{width:400,name:"Update password",onSubmit:A,mt:0,children:[e.jsx(y,{label:"New password",name:"password",value:a.password,onChange:h,required:!0}),e.jsx(y,{label:"Confirm new password",name:"confirmPassword",value:a.confirmPassword,onChange:h,required:!0}),e.jsx(E,{pass:a.password,confirmPass:a.confirmPassword,validations:b}),e.jsx(P,{error:l.password,children:l.password}),e.jsx(C,{success:m.password,children:m.password}),e.jsx(v,{name:"Update",disabled:x.password})]})]})}export{R as default};
