import{j as e,T as d,B as m,u as $,z as L,r as c,a as T,C as B,P,G as h,A as D}from"./index-D3NV2W8y.js";import{B as N}from"./BackButton-D7zhlBl-.js";import z from"./ErrorPage-gmmFdxmY.js";function w({label:l,value:r}){return e.jsxs(d,{variant:"body2",sx:{color:"gray"},children:[l," ",r?new Date(r).toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""]})}function G({comment:l,isLast:r}){return e.jsxs(m,{sx:{mb:2,pb:2,borderBottom:r?"none":"1px solid gray"},children:[e.jsxs(m,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsxs(d,{variant:"subtitle1",fontWeight:600,children:["@",l.author.username]}),e.jsx(d,{variant:"caption",sx:{color:"gray"},children:new Date(l.created_at).toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsx(d,{variant:"body1",sx:{whiteSpace:"pre-line",color:"#333"},children:l.body})]})}function H(){const l=$(),{postId:r}=L(),{token:f}=c.useContext(T),[x,i]=c.useState(null),[n,v]=c.useState(),[p,a]=c.useState({overlay:!0,edit:!1,publish:!1,delete:!1,next:!1,nextAll:!1}),[g,C]=c.useState([]),[E,k]=c.useState(0),[j,b]=c.useState(!0);c.useEffect(()=>{async function s(){a(t=>({...t,overlay:!0}));try{const t=await fetch(`https://blog-backend-production-16f8.up.railway.app/api/posts/${r}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`bearer ${f}`}}),o=await t.json();if(!t.ok){a(u=>({...u,overlay:!1})),i(o.message);return}v(o),C(o.comments),o.total_comments<5&&b(!1),o.total_comments>5&&(b(!0),k(5))}catch{i("Network error")}finally{a(t=>({...t,overlay:!1}))}}s()},[r,f]);async function _(){i(null),a(s=>({...s,publish:!0}));try{const s=await fetch(`https://blog-backend-production-16f8.up.railway.app/api/posts/${r}/publish`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`bearer ${f}`}}),t=await s.json();if(!s.ok){a(o=>({...o,publish:!1})),i(t.message);return}v(t)}catch{i("Network error")}finally{a(s=>({...s,publish:!1}))}}async function S(){i(null),a(s=>({...s,delete:!0}));try{const s=await fetch(`https://blog-backend-production-16f8.up.railway.app/api/posts/${r}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`bearer ${f}`}}),t=await s.json();if(!s.ok){a(o=>({...o,delete:!1})),i(t.message);return}l("/")}catch{i("Network Error")}finally{a(s=>({...s,delete:!1}))}}async function A(s){s>5?a(t=>({...t,nextAll:!0})):a(t=>({...t,next:!0}));try{if(!j)return;const t=await fetch(`https://blog-backend-production-16f8.up.railway.app/api/posts/${r}/comments?limit=${s}&offset=${E}`),o=await t.json();if(!t.ok){a(u=>({...u,next:!1})),a(u=>({...u,nextAll:!1})),i(o.message||"Failed to get comments");return}C(u=>{const y=[...u,...o.comments];return n.total_comments>y.length&&(b(!0),k(y.length)),n.total_comments===y.length&&b(!1),y})}catch{i("Network error")}finally{a(t=>({...t,next:!1})),a(t=>({...t,nextAll:!1}))}}return p.overlay?e.jsx(B,{}):x?e.jsx(z,{message:x}):e.jsxs(m,{sx:{flexGrow:1,width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",position:"relative"},children:[e.jsx(N,{onClick:()=>l("/")}),e.jsxs(P,{elevation:2,sx:{p:4,borderRadius:3,width:600,mt:6},children:[e.jsx(d,{variant:"h4",fontWeight:600,mb:2,children:n.title}),e.jsxs(d,{variant:"subtitle1",sx:{color:"gray",mb:1},children:["by ",e.jsxs("strong",{children:["@",n.author.username]})]}),e.jsx(w,{label:"Created",value:n.created_at}),n.updated_at!==n.created_at&&e.jsx(w,{label:"Updated",value:n.updated_at}),e.jsx(w,{label:n.published?"Published":"Not published",value:n.published_at}),e.jsx(d,{variant:"body1",sx:{whiteSpace:"pre-line",mt:4,mb:4},children:n.body}),e.jsxs(m,{sx:{display:"flex",gap:1},children:[e.jsx(h,{name:"Edit",onClick:()=>l(`/${r}/edit`)}),e.jsx(h,{name:n.published?"Unpublish":"Publish",disabled:p.publish,onClick:_}),e.jsx(h,{name:"Delete",disabled:p.delete,onClick:S})]}),x&&e.jsx(D,{type:"error",children:x})]}),g.length>0&&e.jsxs(P,{elevation:2,sx:{p:4,borderRadius:3,my:6,width:600},children:[e.jsx(d,{variant:"h5",fontWeight:600,mb:2,children:"Comments:"}),g.map((s,t)=>e.jsx(G,{comment:s,isLast:t===g.length-1},s.id)),e.jsxs(m,{sx:{display:"flex",gap:2,mt:2},children:[j&&e.jsx(h,{name:"Load next 5",disabled:p.next,onClick:()=>A(5)}),j&&e.jsx(h,{name:"Load all comments",disabled:p.nextAll,onClick:()=>A(n.total_comments)})]})]})]})}export{H as default};
