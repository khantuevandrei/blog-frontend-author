import{u as A,r as i,a as N,j as a,B as $,A as c}from"./index-ecins54h.js";import{F as v,a as z,P as C}from"./PasswordField-Bdevykqz.js";import{F as P}from"./FormButton-Cp-Fq5tM.js";import{B as O}from"./BackButton-DSHBddhL.js";import{C as U,U as T,P as q}from"./PasswordChecklist-kLJvtrZ7.js";function V(){const k=A(),{user:x,token:w,login:S}=i.useContext(N),[u,o]=i.useState({username:null,password:null}),[l,p]=i.useState({username:null,password:null}),[g,n]=i.useState({username:!1,password:!1}),[e,f]=i.useState({username:"",password:"",confirmPassword:""}),b={length:/^.{3,20}$/,validChars:/^[A-Za-z0-9_]+$/},j={length:b.length.test(e.username),validChars:b.validChars.test(e.username)},d={lowercase:/[a-z]/,uppercase:/[A-Z]/,number:/\d/,symbol:/[!@#$%^&*()_\-+=[\]{};:"\\|,.<>/?]/,length:/.{8,}/},y={length:d.length.test(e.password),lowercase:d.lowercase.test(e.password),uppercase:d.uppercase.test(e.password),number:d.number.test(e.password),symbol:d.symbol.test(e.password),passwordsMatch:e.password&&e.password===e.confirmPassword};function h(t){f({...e,[t.target.name]:t.target.value.trim()})}async function B(t){if(t.preventDefault(),n(s=>({...s,username:!0})),o(s=>({...s,username:null})),p(s=>({...s,username:null})),Object.values(j).some(s=>!s)){n(!1),o(s=>({...s,username:"Please fix username validation errors"}));return}try{const s=await fetch(`https://blog-backend-production-16f8.up.railway.app/api/users/${x.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`bearer ${w}`},body:JSON.stringify({username:e.username})}),m=await s.json();if(!s.ok){o(r=>({...r,username:m.message}));return}f(r=>({...r,username:""})),p(r=>({...r,username:"Username updated"})),S(w,m)}catch{o(s=>({...s,username:"Network error"}))}finally{n(s=>({...s,username:!1}))}}async function F(t){if(t.preventDefault(),n(s=>({...s,password:!0})),o(s=>({...s,password:null})),p(s=>({...s,password:null})),Object.values(y).some(s=>!s)){n(!1),o(s=>({...s,password:"Please fix password validation errors"}));return}if(e.password!==e.confirmPassword){o(s=>({...s,password:"Passwords do not match"}));return}try{const s=await fetch(`https://blog-backend-production-16f8.up.railway.app/api/users/${x.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`bearer ${w}`},body:JSON.stringify({password:e.password})}),m=await s.json();if(!s.ok){o(r=>({...r,password:m.message}));return}f(r=>({...r,password:"",confirmPassword:""})),p(r=>({...r,password:"Password updated"}))}catch{o(s=>({...s,password:"Network error"}))}finally{n(s=>({...s,password:!1}))}}return a.jsxs($,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",flexGrow:1,gap:4,position:"relative"},children:[a.jsx(O,{onClick:()=>k("/")}),a.jsxs(v,{width:400,name:"Update username",onSubmit:B,mb:0,children:[a.jsx(z,{label:"New username",name:"username",value:e.username,onChange:h,required:!0}),a.jsx(U,{in:!!e.username,timeout:300,children:a.jsx(T,{validations:j})}),u.username&&a.jsx(c,{type:"error",children:u.username}),l.username&&a.jsx(c,{type:"success",children:l.username}),a.jsx(P,{name:"Update",disabled:g.username})]}),a.jsxs(v,{width:400,name:"Update password",onSubmit:F,mt:0,children:[a.jsx(C,{label:"New password",name:"password",value:e.password,onChange:h,required:!0}),a.jsx(C,{label:"Confirm new password",name:"confirmPassword",value:e.confirmPassword,onChange:h,required:!0}),a.jsx(U,{in:!!(e.password||e.confirmPassword),timeout:300,children:a.jsx(q,{validations:y})}),u.password&&a.jsx(c,{type:"error",children:u.password}),l.password&&a.jsx(c,{type:"success",children:l.password}),a.jsx(P,{name:"Update",disabled:g.password})]})]})}export{V as default};
