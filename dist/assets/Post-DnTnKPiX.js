import{a as C,j as e,T as d,B as f,u as T,E as B,r as c,b as D,F as N,P as _,G as m,A as G}from"./index-DbtmEfME.js";import{B as M}from"./BackButton-7gMYRNk2.js";import z from"./ErrorPage-BPHAXaVq.js";function v({label:l,value:p}){const r=C();return e.jsxs(d,{variant:"body2",sx:{color:r.palette.text.secondary},children:[l," ",p?new Date(p).toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""]})}function R({comment:l,isLast:p}){const r=C();return e.jsxs(f,{sx:{mb:2,pb:2,borderBottom:p?"none":"1px solid gray"},children:[e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsxs(d,{variant:"subtitle1",fontWeight:600,children:["@",l.author.username]}),e.jsx(d,{variant:"caption",sx:{color:r.palette.text.secondary},children:new Date(l.created_at).toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsx(d,{variant:"body1",sx:{whiteSpace:"pre-line",color:r.palette.text.primary},children:l.body})]})}function I(){const l=T(),p=C(),{postId:r}=B(),{token:x}=c.useContext(D),[b,i]=c.useState(null),[n,k]=c.useState(),[h,a]=c.useState({overlay:!0,edit:!1,publish:!1,delete:!1,next:!1,nextAll:!1}),[g,A]=c.useState([]),[S,E]=c.useState(0),[w,y]=c.useState(!0);c.useEffect(()=>{async function s(){a(t=>({...t,overlay:!0}));try{const t=await fetch(`https://blog-backend-production-16f8.up.railway.app/api/posts/${r}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`bearer ${x}`}}),o=await t.json();if(!t.ok){a(u=>({...u,overlay:!1})),i(o.message);return}k(o),A(o.comments),o.total_comments<5&&y(!1),o.total_comments>5&&(y(!0),E(5))}catch{i("Network error")}finally{a(t=>({...t,overlay:!1}))}}s()},[r,x]);async function $(){i(null),a(s=>({...s,publish:!0}));try{const s=await fetch(`https://blog-backend-production-16f8.up.railway.app/api/posts/${r}/publish`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`bearer ${x}`}}),t=await s.json();if(!s.ok){a(o=>({...o,publish:!1})),i(t.message);return}k(t)}catch{i("Network error")}finally{a(s=>({...s,publish:!1}))}}async function L(){i(null),a(s=>({...s,delete:!0}));try{const s=await fetch(`https://blog-backend-production-16f8.up.railway.app/api/posts/${r}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`bearer ${x}`}}),t=await s.json();if(!s.ok){a(o=>({...o,delete:!1})),i(t.message);return}l("/")}catch{i("Network Error")}finally{a(s=>({...s,delete:!1}))}}async function P(s){s>5?a(t=>({...t,nextAll:!0})):a(t=>({...t,next:!0}));try{if(!w)return;const t=await fetch(`https://blog-backend-production-16f8.up.railway.app/api/posts/${r}/comments?limit=${s}&offset=${S}`),o=await t.json();if(!t.ok){a(u=>({...u,next:!1})),a(u=>({...u,nextAll:!1})),i(o.message||"Failed to get comments");return}A(u=>{const j=[...u,...o.comments];return n.total_comments>j.length&&(y(!0),E(j.length)),n.total_comments===j.length&&y(!1),j})}catch{i("Network error")}finally{a(t=>({...t,next:!1})),a(t=>({...t,nextAll:!1}))}}return h.overlay?e.jsx(N,{}):b?e.jsx(z,{message:b}):e.jsxs(f,{sx:{flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[e.jsxs(_,{elevation:2,sx:{p:4,borderRadius:3,width:600,mt:6,position:"relative"},children:[e.jsx(M,{onClick:()=>l("/")}),e.jsx(d,{variant:"h4",fontWeight:600,mb:2,children:n.title}),e.jsxs(d,{variant:"subtitle1",sx:{color:p.palette.text.secondary,mb:1},children:["by ",e.jsxs("strong",{children:["@",n.author.username]})]}),e.jsx(v,{label:"Created",value:n.created_at}),n.updated_at!==n.created_at&&e.jsx(v,{label:"Updated",value:n.updated_at}),e.jsx(v,{label:n.published?"Published":"Not published",value:n.published_at}),e.jsx(d,{variant:"body1",sx:{whiteSpace:"pre-line",mt:4,mb:2},children:n.body}),e.jsxs(f,{sx:{display:"flex",justifyContent:"center",gap:1},children:[e.jsx(m,{name:"Edit",onClick:()=>l(`/${r}/edit`)}),e.jsx(m,{name:n.published?"Unpublish":"Publish",disabled:h.publish,onClick:$}),e.jsx(m,{name:"Delete",disabled:h.delete,onClick:L})]}),b&&e.jsx(G,{type:"error",children:b})]}),g.length>0&&e.jsxs(_,{elevation:2,sx:{p:4,borderRadius:3,my:6,width:600},children:[e.jsx(d,{variant:"h5",fontWeight:600,mb:2,children:"Comments:"}),g.map((s,t)=>e.jsx(R,{comment:s,isLast:t===g.length-1},s.id)),e.jsxs(f,{sx:{display:"flex",gap:2,mt:2},children:[w&&e.jsx(m,{name:"Load next 5",disabled:h.next,onClick:()=>P(5)}),w&&e.jsx(m,{name:"Load all comments",disabled:h.nextAll,onClick:()=>P(n.total_comments)})]})]})]})}export{I as default};
